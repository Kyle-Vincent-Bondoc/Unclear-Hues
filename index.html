<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Unclear Hues</title>
<style>
  body {
    font-family: Arial, sans-serif;
    text-align: center;
    background: #1e1e1e;
    color: #f1f1f1;
  }
  canvas {
    border: 2px solid #f1f1f1;
    margin-top: 20px;
    cursor: crosshair;
  }
  #score, #spectrums {
    font-size: 24px;
    margin-top: 15px;
  }
  #colorCode {
    font-size: 20px;
    margin-top: 10px;
    font-weight: bold;
  }
  button {
    margin: 10px 5px;
    padding: 10px 20px;
    font-size: 16px;
    cursor: pointer;
  }
</style>
</head>
<body>
<h1>Unclear Hues</h1>
<p>Click where you think the color is based on the hex code below!</p>
<div id="colorCode">#FFFFFF</div>
<canvas id="colorCanvas" width="400" height="400"></canvas>
<div>
    <button id="submitBtn">Submit</button>
    <button onclick="newColor()">Next Color</button>
    <button id="revealBtn">Reveal Color</button>
</div>
<div id="score">Score: 0</div>
<div id="spectrums">Spectrums: 0</div>
<p><b>Click <a href="paint.html">Here</a></b> to go to a paint tool.</p>

<script>
const canvas = document.getElementById('colorCanvas');
const ctx = canvas.getContext('2d');
const width = canvas.width;
const height = canvas.height;
const center = {x: width/2, y: height/2};
let targetColor, score = 0, spectrums = 0;
let guess = null;
let isRevealing = false;

// Draw the circular color graph
function drawColorWheel(saturation = 1, reveal=false) {
    const radius = width/2 - 2;
    const imageData = ctx.createImageData(width, height);
    for (let x = 0; x < width; x++) {
        for (let y = 0; y < height; y++) {
            const dx = x - center.x;
            const dy = y - center.y;
            const distance = Math.sqrt(dx*dx + dy*dy);
            if(distance <= radius) {
                const angle = Math.atan2(dy, dx) * 180 / Math.PI;
                let hue = angle < 0 ? angle + 360 : angle;
                let lightness = distance / radius;
                const rgb = hslToRgb(hue, saturation, lightness);
                const index = (y*width + x)*4;
                imageData.data[index] = rgb[0];
                imageData.data[index+1] = rgb[1];
                imageData.data[index+2] = rgb[2];
                imageData.data[index+3] = 255;
            }
        }
    }
    ctx.putImageData(imageData, 0, 0);

    // Show guess point if exists
    if(guess) {
        ctx.beginPath();
        ctx.arc(guess.x, guess.y, 6, 0, 2*Math.PI);
        ctx.strokeStyle = '#FFF';
        ctx.lineWidth = 3;
        ctx.stroke();
    }

    // Show reveal marker
    if(reveal) {
        const rad = targetColor.lightness * radius;
        const angleRad = targetColor.hue * Math.PI / 180;
        const x = center.x + rad * Math.cos(angleRad);
        const y = center.y + rad * Math.sin(angleRad);
        ctx.beginPath();
        ctx.arc(x, y, 8, 0, 2*Math.PI);
        ctx.strokeStyle = 'yellow';
        ctx.lineWidth = 3;
        ctx.setLineDash([5,5]);
        ctx.stroke();
        ctx.setLineDash([]);
    }
}

// Convert HSL to RGB
function hslToRgb(h, s, l) {
    h /= 360;
    let r, g, b;
    if(s === 0) {
        r = g = b = l;
    } else {
        const hue2rgb = (p, q, t) => {
            if(t < 0) t+=1;
            if(t > 1) t-=1;
            if(t < 1/6) return p + (q-p)*6*t;
            if(t < 1/2) return q;
            if(t < 2/3) return p + (q-p)*(2/3 - t)*6;
            return p;
        };
        const q = l < 0.5 ? l*(1+s) : l + s - l*s;
        const p = 2*l - q;
        r = hue2rgb(p,q,h+1/3);
        g = hue2rgb(p,q,h);
        b = hue2rgb(p,q,h-1/3);
    }
    return [Math.round(r*255), Math.round(g*255), Math.round(b*255)];
}

// Convert RGB to HEX
function rgbToHex(r,g,b) {
    return "#" + ((1<<24) + (r<<16) + (g<<8) + b).toString(16).slice(1).toUpperCase();
}

// Pick a random target color
function newColor() {
    const hue = Math.random()*360;
    const lightness = Math.random();
    const saturation = 0.8 + Math.random()*0.2; // 0.8-1
    targetColor = {hue, lightness, saturation};
    guess = null;
    drawColorWheel(saturation);
    const rgb = hslToRgb(hue, saturation, lightness);
    document.getElementById('colorCode').innerText = rgbToHex(...rgb);
}

// Handle player click to mark guess
canvas.addEventListener('click', (e) => {
    const rect = canvas.getBoundingClientRect();
    guess = {x: e.clientX - rect.left, y: e.clientY - rect.top};
    drawColorWheel(targetColor.saturation);
});

// Submit button scoring with reveal
document.getElementById('submitBtn').addEventListener('click', () => {
    if(!guess) return; // no guess made
    const dx = guess.x - center.x;
    const dy = guess.y - center.y;
    const distance = Math.sqrt(dx*dx + dy*dy)/(width/2-2);
    let angle = Math.atan2(dy,dx)*180/Math.PI;
    if(angle<0) angle+=360;

    // Loop-aware hue difference
    let diff = Math.abs(angle - targetColor.hue);
    let hueDiff = Math.min(diff, 360 - diff);

    let points = 0;
    if(hueDiff < 120) {
        points = Math.round(50*(1 - hueDiff/120));
    }

    score += points;

    // Handle 360+ point reset
    if(score >= 360) {
        score -= 360;
        spectrums += 1;
    }

    document.getElementById('score').innerText = `Score: ${score}`;
    document.getElementById('spectrums').innerText = `Spectrums: ${spectrums}`;

    // Reveal color for 5 seconds before next
    isRevealing = true;
    drawColorWheel(targetColor.saturation, true);
    guess = null;
    setTimeout(() => {
        isRevealing = false;
        newColor();
    }, 5000);
});

// Reveal color button
document.getElementById('revealBtn').addEventListener('click', () => {
    drawColorWheel(targetColor.saturation, true);
});

// Start first round
newColor();
</script>
</body>
</html>
